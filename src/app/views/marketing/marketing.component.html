<c-row>
    <c-col xs>
        <c-card class="mb-4">

            <!-- Header Section -->
            <c-card-header>Marketing</c-card-header>

            <!-- Modal Add Template -->
            <c-modal size="xl" id="addTemplateDemoModal" [visible]="visibleAddTemplate" (visibleChange)="handleAddTemplateDemoChange($event)">
               
                <c-modal-header>
                    <h5 cModalTitle>Add New Template</h5>
                    <button (click)="toggleAddTemplateDemo()" cButtonClose></button>
                </c-modal-header>

                <c-modal-body>
                    <div class="row">

                        <!-- First Section -->
                        <div class="col-md-7">

                            <!-- Main card -->
                            <c-card>
                                <c-card-header class="d-flex justify-content-between">
                                    <div>
                                        Buy Additional Themes
                                    </div>
                                    <span class="ms-4 typewriter">
                                        <strong>Coming soon...</strong>
                                    </span>
                                </c-card-header>
                                <!-- Main card Body -->
                                <c-card-body>

                                    <!-- First card -->
                                    <c-card>
                                        <c-card-header class="fw-bold">Templates</c-card-header>
                                        <c-card-body>
                                            <div class="d-flex flex-wrap justify-content-center gap-4">

                                                <!-- If data Are Available -->
                                                <div *ngFor="let temp of allTemplates" class="position-relative" style="width: 150px;">

                                                    <!-- Card -->
                                                    <div class="p-3 border rounded position-relative" (mouseenter)="hoveredTemplateId = temp._id" (mouseleave)="hoveredTemplateId = null" [ngStyle]="{'background-color': temp.backgroundColor || '#8000b0', 'border-color': temp.backgroundColor || '#8000b0'}">

                                                        <!-- Delete Button (only visible on hover) -->
                                                        <button class="btn btn-sm btn-danger position-absolute top-0 end-0 m-1 d-flex align-items-center justify-content-center" *ngIf="hoveredTemplateId === temp._id" [disabled]="deletingTemplateId === temp._id" (click)="deleteTemplate(temp._id)" title="Delete Template">

                                                            <ng-container *ngIf="deletingTemplateId === temp._id; else deleteText">
                                                                <span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>
                                                            </ng-container>

                                                            <ng-template #deleteText>
                                                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-trash" viewBox="0 0 16 16">
                                                                    <path d="M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5m2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5m3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0z" />
                                                                    <path d="M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1zM4.118 4 4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4zM2.5 3h11V2h-11z" />
                                                                </svg>
                                                            </ng-template>

                                                        </button>


                                                        <!-- New Share Template Button -->
                                                        <button *ngIf="hoveredTemplateId === temp._id" (click)="openShareTemplateModal(temp._id)" class="btn btn-sm btn-dark position-absolute top-0 end-0 mt-5 me-1 d-flex align-items-center justify-content-center" title="Share Template">
                                                            <svg xmlns="http://www.w3.org/2000/svg" width="16"height="16" fill="currentColor" class="bi bi-share"viewBox="0 0 16 16">
                                                                <path d="M13.5 1a1.5 1.5 0 1 0 0 3 1.5 1.5 0 0 0 0-3M11 2.5a2.5 2.5 0 1 1 .603 1.628l-6.718 3.12a2.5 2.5 0 0 1 0 1.504l6.718 3.12a2.5 2.5 0 1 1-.488.876l-6.718-3.12a2.5 2.5 0 1 1 0-3.256l6.718-3.12A2.5 2.5 0 0 1 11 2.5m-8.5 4a1.5 1.5 0 1 0 0 3 1.5 1.5 0 0 0 0-3m11 5.5a1.5 1.5 0 1 0 0 3 1.5 1.5 0 0 0 0-3" />
                                                            </svg>
                                                        </button>


                                                        <!-- Mobile Preview Template Modal Trigger -->
                                                        <button *ngIf="hoveredTemplateId === temp._id" (click)="togglePreTempDemo(temp._id, temp.titleHtml, temp.contentHtml)" class="btn btn-sm btn-dark position-absolute end-0 me-1 d-flex align-items-center justify-content-center" style="top: 90px;"  title="Mobile Preview Template">
                                                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-phone" viewBox="0 0 16 16">
                                                                <path d="M11 1a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1H5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1zM5 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h6a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2z"/>
                                                                <path d="M8 14a1 1 0 1 0 0-2 1 1 0 0 0 0 2"/>
                                                            </svg>
                                                        </button>


                                                        <!-- Desktop Preview Template Modal Trigger -->
                                                        <button *ngIf="hoveredTemplateId === temp._id" (click)="toggleDesPreTempDemo(temp._id, temp.titleHtml, temp.contentHtml)" class="btn btn-sm btn-dark position-absolute end-0 me-1 d-flex align-items-center justify-content-center" style="top: 130px;" title="Desktop Preview Template">
                                                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-display" viewBox="0 0 16 16">
                                                                <path d="M0 4s0-2 2-2h12s2 0 2 2v6s0 2-2 2h-4q0 1 .25 1.5H11a.5.5 0 0 1 0 1H5a.5.5 0 0 1 0-1h.75Q6 13 6 12H2s-2 0-2-2zm1.398-.855a.76.76 0 0 0-.254.302A1.5 1.5 0 0 0 1 4.01V10c0 .325.078.502.145.602q.105.156.302.254a1.5 1.5 0 0 0 .538.143L2.01 11H14c.325 0 .502-.078.602-.145a.76.76 0 0 0 .254-.302 1.5 1.5 0 0 0 .143-.538L15 9.99V4c0-.325-.078-.502-.145-.602a.76.76 0 0 0-.302-.254A1.5 1.5 0 0 0 13.99 3H2c-.325 0-.502.078-.602.145"/>
                                                            </svg>
                                                        </button>


                                                        <!-- Share Template Modal -->
                                                        <c-modal id="shareTempModal" [visible]="visibleShareTemp" (visibleChange)="handleShareTempDemoChange($event)">

                                                            <c-modal-header>
                                                                <h5 cModalTitle>Share Templates</h5>
                                                                <button (click)="toggleShareTempDemo()" cButtonClose></button>
                                                            </c-modal-header>

                                                            <c-modal-body>
                                                                <!-- Tabs -->
                                                                <ul class="nav nav-tabs mb-3">
                                                                    <li class="nav-item">
                                                                        <button class="nav-link" [ngClass]="{ active: shareTab === 'group' }" (click)="shareTab = 'group'">Groups</button>
                                                                    </li>

                                                                    <li class="nav-item">
                                                                        <button class="nav-link" [ngClass]="{ active: shareTab === 'client' }" (click)="shareTab = 'client'">Clients</button>
                                                                    </li>
                                                                </ul>

                                                                <!-- Tab Content -->
                                                                <div>
                                                                    <!-- Group Tab -->
                                                                    <div *ngIf="shareTab === 'group'">

                                                                        <div class="mb-3">
                                                                            <input type="text" class="form-control" placeholder="Search Groups..." [(ngModel)]="groupSearchText" />
                                                                        </div>

                                                                        <div class="border rounded p-2" style="max-height: 250px; overflow-y: auto; position: relative;">

                                                                            <!-- Select All Checkbox -->
                                                                            <div class="form-check mb-2">
                                                                                <input class="form-check-input" type="checkbox" id="selectAllGroups" [checked]="areAllGroupsSelected()" (change)="toggleSelectAllGroups($event)" />
                                                                                <label class="form-check-label" for="selectAllGroups">Select All</label>
                                                                            </div>

                                                                            <!-- Group List -->
                                                                            <div class="form-check" *ngFor="let group of filteredGroups()">
                                                                                <input class="form-check-input" type="checkbox" [id]="group._id"  [checked]="selectedGroupIds.includes(group._id)" (change)="onGroupCheckboxChange($event, group)">
                                                                                <label class="form-check-label" [for]="group._id"> {{ group.groupName ? (group.groupName.charAt(0).toUpperCase() + group.groupName.slice(1)) : '' }} ({{ group.clients?.length || 0 }} clients)</label>
                                                                            </div>

                                                                            <!-- No Groups Founds -->
                                                                            <div *ngIf="filteredGroups().length === 0" class="text-danger text-center mt-2">
                                                                                No groups found.
                                                                            </div>

                                                                        </div>

                                                                    </div>

                                                                    <!-- Clients Tab -->
                                                                    <div *ngIf="shareTab === 'client'">

                                                                        <div class="mb-3">
                                                                            <input type="text" class="form-control" placeholder="Search Clients..." [(ngModel)]="searchClientText" />
                                                                        </div>

                                                                        <div class="border rounded p-2" style="max-height: 250px; overflow-y: auto;">

                                                                            <!-- Select All Checkbox -->
                                                                            <div class="form-check mb-2">
                                                                                <input class="form-check-input" type="checkbox" id="selectAllClients" [checked]="areAllClientsSelected()" (change)="toggleSelectAllClients($event)"/>
                                                                                <label class="form-check-label" for="selectAllClients">Select All</label>
                                                                            </div>
                                                                            

                                                                            <!-- Client List -->
                                                                            <div class="form-check" *ngFor="let client of filteredClients()">
                                                                                <input class="form-check-input" type="checkbox" [id]="client._id" [checked]="selectedClientIds.includes(client._id)" (change)="onClientCheckboxChange($event, client._id)" />
                                                                                <label class="form-check-label" [for]="client._id">{{ client.name ? (client.name.charAt(0).toUpperCase() + client.name.slice(1)) : 'Unnamed Client' }} - {{ client.email }}</label>
                                                                            </div>

                                                                            <!-- No Clients Available -->
                                                                            <div *ngIf="allClients.length === 0" class="text-danger text-center">No clients found </div>

                                                                        </div>

                                                                    </div>

                                                                </div>
                                                            </c-modal-body>

                                                            <c-modal-footer>
                                                                <button (click)="toggleShareTempDemo()" cButton color="secondary">Close</button>

                                                                <!-- Share Button -->
                                                                <button (click)="shareTemplateToSelectedClients()" [disabled]="isSharing" cButton color="primary">
                                                                    <span *ngIf="!isSharing">Share Template</span>
                                                                    <span *ngIf="isSharing">
                                                                        <span class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></span>Sharing...
                                                                    </span>
                                                                </button>

                                                            </c-modal-footer>

                                                        </c-modal>


                                                        <!-- Mobile Preview Template -->
                                                        <c-modal size="lg" id="preTemplateModal" [visible]="visiblePreTemp" (visibleChange)="handlePreTempChange($event)">
                                                            <c-modal-header>
                                                                <h5 cModalTitle>Template Preview - {{ selectedTemplateTitle }}</h5>
                                                                <button (click)="togglePreTempDemo()" cButtonClose></button>
                                                            </c-modal-header>
                                                        
                                                            <c-modal-body>
                                                                <div class="d-flex justify-content-center">
                                                                  <div style="width: 320px; background: #000; border-radius: 40px; padding: 15px 8px; position: relative; box-shadow: 0 0 15px rgba(0,0,0,0.3);">
                                                              
                                                                    <!-- Top Speaker Slot -->
                                                                    <div class="d-flex justify-content-center mb-1">
                                                                      <div style="width: 50px; height: 5px; background: #333; border-radius: 3px;"></div>
                                                                    </div>
                                                              
                                                                    <!-- Mobile Screen Frame -->
                                                                    <div style="background: #fff; border-radius: 25px; overflow: hidden; height: 500px; overflow-y: auto;">
                                                              
                                                                      <!-- Status Bar (Time, Network, Battery) -->
                                                                      <div class="d-flex justify-content-between align-items-center bg-light px-3 py-1 border-bottom" style="height: 28px; font-size: 11px; font-weight: bold;">
                                                                        <div>9:41 AM</div>
                                                                        <div class="d-flex align-items-center gap-2">
                                                                          <!-- Signal Bars -->
                                                                          <div class="d-flex align-items-end" style="gap: 1px;">
                                                                            <div style="width: 2px; height: 5px; background-color: #000;"></div>
                                                                            <div style="width: 2px; height: 7px; background-color: #000;"></div>
                                                                            <div style="width: 2px; height: 9px; background-color: #000;"></div>
                                                                            <div style="width: 2px; height: 11px; background-color: #000;"></div>
                                                                          </div>
                                                                          <!-- WiFi & Battery Icons -->
                                                                          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-wifi" viewBox="0 0 16 16">
                                                                            <path d="M15.384 6.115a.485.485 0 0 0-.047-.736A12.44 12.44 0 0 0 8 3C5.259 3 2.723 3.882.663 5.379a.485.485 0 0 0-.048.736.52.52 0 0 0 .668.05A11.45 11.45 0 0 1 8 4c2.507 0 4.827.802 6.716 2.164.205.148.49.13.668-.049"/>
                                                                            <path d="M13.229 8.271a.482.482 0 0 0-.063-.745A9.46 9.46 0 0 0 8 6c-1.905 0-3.68.56-5.166 1.526a.48.48 0 0 0-.063.745.525.525 0 0 0 .652.065A8.46 8.46 0 0 1 8 7a8.46 8.46 0 0 1 4.576 1.336c.206.132.48.108.653-.065m-2.183 2.183c.226-.226.185-.605-.1-.75A6.5 6.5 0 0 0 8 9c-1.06 0-2.062.254-2.946.704-.285.145-.326.524-.1.75l.015.015c.16.16.407.19.611.09A5.5 5.5 0 0 1 8 10c.868 0 1.69.201 2.42.56.203.1.45.07.61-.091zM9.06 12.44c.196-.196.198-.52-.04-.66A2 2 0 0 0 8 11.5a2 2 0 0 0-1.02.28c-.238.14-.236.464-.04.66l.706.706a.5.5 0 0 0 .707 0l.707-.707z"/>
                                                                          </svg>
                                                                          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-battery-half" viewBox="0 0 16 16">
                                                                            <path d="M2 6h5v4H2z"/>
                                                                            <path d="M2 4a2 2 0 0 0-2 2v4a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V6a2 2 0 0 0-2-2zm10 1a1 1 0 0 1 1 1v4a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V6a1 1 0 0 1 1-1zm4 3a1.5 1.5 0 0 1-1.5 1.5v-3A1.5 1.5 0 0 1 16 8"/>
                                                                          </svg>

                                                                        </div>
                                                                      </div>
                                                              
                                                                      <!-- Screen Content (Template Preview) -->
                                                                      <div class="bg-white p-2 border" style="max-width: 1000px; margin: auto; font-family: Arial, sans-serif;">
  
                                                                        <!-- Header -->
                                                                        <div class="d-flex justify-content-between align-items-start mb-3">
                                                                            <div>
                                                                              <h5 class="fw-normal mb-1">Here’s a new template for you</h5>
                                                                              <span class="badge bg-warning text-dark me-1">External</span>
                                                                              <span class="badge bg-light text-dark border">Inbox</span>
                                                                            </div>
                                                                          
                                                                            <!-- Right-aligned empty star icon -->
                                                                            <div>
                                                                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-star" viewBox="0 0 16 16">
                                                                                    <path d="M2.866 14.85c-.078.444.36.791.746.593l4.39-2.256 4.389 2.256c.386.198.824-.149.746-.592l-.83-4.73 3.522-3.356c.33-.314.16-.888-.282-.95l-4.898-.696L8.465.792a.513.513 0 0 0-.927 0L5.354 5.12l-4.898.696c-.441.062-.612.636-.283.95l3.523 3.356-.83 4.73zm4.905-2.767-3.686 1.894.694-3.957a.56.56 0 0 0-.163-.505L1.71 6.745l4.052-.576a.53.53 0 0 0 .393-.288L8 2.223l1.847 3.658a.53.53 0 0 0 .393.288l4.052.575-2.906 2.77a.56.56 0 0 0-.163.506l.694 3.957-3.686-1.894a.5.5 0 0 0-.461 0z"/>
                                                                                </svg>
                                                                            </div>
                                                                        </div>
                                                                          
                                                                      
                                                                        <!-- Sender Info -->
                                                                        <div class="d-flex align-items-center mb-3">
                                                                          <div class="rounded-circle bg-primary text-white text-center me-2" style="width: 40px; height: 40px; line-height: 40px;">
                                                                            A
                                                                          </div>
                                                                          <div>
                                                                            <strong>admin&#64;gmail.com</strong><br>
                                                                            <small class="text-muted">10:00 am</small>
                                                                          </div>
                                                                        </div>
                                                                      
                                                                        <!-- Email Content -->
                                                                        <div *ngIf="selectedTemplate" class="d-flex flex-wrap justify-content-center gap-4">
                                                                            <div class="position-relative" style="width: 300px;">
                                                                              <div class="p-3 border rounded position-relative"
                                                                                   [ngStyle]="{
                                                                                     'background-color': selectedTemplate.backgroundColor || '#ffeb00',
                                                                                     'border-color': selectedTemplate.backgroundColor || '#ffeb00'
                                                                                   }">
                                                                          
                                                                                <!-- Logo Section -->
                                                                                <div class="d-flex justify-content-center mb-3">
                                                                                  <div style="width: 80px; height: 80px; background-color: white; border-radius: 5px;">
                                                                                    <img *ngIf="selectedTemplate.logo?.length" [src]="selectedTemplate.logo[0].url" alt="Logo" style="width: 100%; height: 100%; object-fit: cover; border: 1px solid white;" />
                                                                                  </div>
                                                                                </div>
                                                                          
                                                                                <!-- Alert Title -->
                                                                                <div class="bg-white text-center py-2 mb-2"
                                                                                     [ngStyle]="{
                                                                                       'color': selectedTemplate.titleFontColor,
                                                                                       'font-family': selectedTemplate.titleFontFamily,
                                                                                       'font-weight': selectedTemplate.titleisBold ? 'bold' : 'normal',
                                                                                       'font-style': selectedTemplate.titleisItalic ? 'italic' : 'normal',
                                                                                       'font-size.px': selectedTemplate.titleFontSize || 16
                                                                                     }">
                                                                                  {{ stripAndTruncateHtml(selectedTemplate.titleHtml) }}
                                                                                </div>
                                                                          
                                                                                <!-- Description -->
                                                                                <div class="bg-white p-3" style="min-height: 180px;"
                                                                                     [ngStyle]="{
                                                                                       'color': selectedTemplate.desFontColor,
                                                                                       'font-size.px': 14
                                                                                     }">
                                                                                  {{ stripAndTruncateHtml(selectedTemplate.descHtml) }}
                                                                                </div>
                                                                          
                                                                              </div>
                                                                            </div>
                                                                        </div>
                                                                          
                                                                      
                                                                        <!-- Reply and Forward Buttons -->
                                                                        <div class="d-flex justify-content-around mt-4">
                                                                          <button class="btn btn-outline-secondary rounded-pill px-4">↩️ Reply</button>
                                                                          <button class="btn btn-outline-secondary rounded-pill px-4">➡️ Forward</button>
                                                                        </div>
                                                                      
                                                                      </div>
                                                                      
                                                                      
                                                                    </div>
                                                              
                                                                    <!-- Bottom Home Button -->
                                                                    <div class="d-flex justify-content-center mt-2">
                                                                      <div style="width: 40px; height: 40px; background: #333; border-radius: 50%;"></div>
                                                                    </div>
                                                              
                                                                  </div>
                                                                </div>
                                                            </c-modal-body>
                                                              
                                                              

                                                            <c-modal-footer>
                                                                <button (click)="togglePreTempDemo()" cButton color="secondary">Close</button>
                                                            </c-modal-footer>
                                                        </c-modal>


                                                        <!-- Desktop Preview Template -->
                                                        <c-modal size="xl" id="desTemplateModal" [visible]="visibleDesPreTemp" (visibleChange)="handleDesPreTempChange($event)">
                                                            <c-modal-header>
                                                                <h5 cModalTitle>Template Desktop Preview - {{ selectedTemplateTitle }}</h5>
                                                                <button (click)="toggleDesPreTempDemo()" cButtonClose></button>
                                                            </c-modal-header>

                                                            <c-modal-body>
                                                                <div class="d-flex justify-content-center">
                                                                  <div style="width: 1000px; background: #000; border-radius: 40px; padding: 20px; position: relative; box-shadow: 0 0 20px rgba(0,0,0,0.3);">
                                                                    
                                                                    <!-- Screen Content Area -->
                                                                    <div style="background: #fff; border-radius: 10px; overflow: hidden; height: 600px; overflow-y: auto; font-family: Arial, sans-serif; max-width: 1000px; margin: auto;">
  
                                                                        <!-- Header -->
                                                                        <div class="d-flex justify-content-between lign-items-start p-3">
                                                                            <div class="d-flex">
                                                                                <h5 class="fw-normal m-1 me-3">Here’s a new template for you</h5>
                                                                                <span class="badge bg-warning text-dark me-2 mt-2">External</span>
                                                                                <span class="badge bg-light text-dark border mt-2">Inbox</span> 
                                                                            </div>

                                                                            <div class="d-flex justify-content-between mt-2">
                                                                                <span class="me-3">
                                                                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-printer" viewBox="0 0 16 16">
                                                                                        <path d="M2.5 8a.5.5 0 1 0 0-1 .5.5 0 0 0 0 1"/>
                                                                                        <path d="M5 1a2 2 0 0 0-2 2v2H2a2 2 0 0 0-2 2v3a2 2 0 0 0 2 2h1v1a2 2 0 0 0 2 2h6a2 2 0 0 0 2-2v-1h1a2 2 0 0 0 2-2V7a2 2 0 0 0-2-2h-1V3a2 2 0 0 0-2-2zM4 3a1 1 0 0 1 1-1h6a1 1 0 0 1 1 1v2H4zm1 5a2 2 0 0 0-2 2v1H2a1 1 0 0 1-1-1V7a1 1 0 0 1 1-1h12a1 1 0 0 1 1 1v3a1 1 0 0 1-1 1h-1v-1a2 2 0 0 0-2-2zm7 2v3a1 1 0 0 1-1 1H5a1 1 0 0 1-1-1v-3a1 1 0 0 1 1-1h6a1 1 0 0 1 1 1"/>
                                                                                    </svg>
                                                                                </span>

                                                                                <span class="mx-2">
                                                                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-box-arrow-up-right" viewBox="0 0 16 16">
                                                                                        <path fill-rule="evenodd" d="M8.636 3.5a.5.5 0 0 0-.5-.5H1.5A1.5 1.5 0 0 0 0 4.5v10A1.5 1.5 0 0 0 1.5 16h10a1.5 1.5 0 0 0 1.5-1.5V7.864a.5.5 0 0 0-1 0V14.5a.5.5 0 0 1-.5.5h-10a.5.5 0 0 1-.5-.5v-10a.5.5 0 0 1 .5-.5h6.636a.5.5 0 0 0 .5-.5"/>
                                                                                        <path fill-rule="evenodd" d="M16 .5a.5.5 0 0 0-.5-.5h-5a.5.5 0 0 0 0 1h3.793L6.146 9.146a.5.5 0 1 0 .708.708L15 1.707V5.5a.5.5 0 0 0 1 0z"/>
                                                                                    </svg>
                                                                                </span>
                                                                            </div> 

                                                                        </div>
                                                                        
                                                                        <!-- Sender Info -->
                                                                        <div class="d-flex justify-content-between align-items-center p-3">
                                                                            <div class="d-flex">
                                                                                <div class="rounded-circle bg-primary text-white text-center me-2" style="width: 40px; height: 40px; line-height: 40px;">
                                                                                    A
                                                                                </div>
                                                                                <div>
                                                                                    <strong>admin&#64;gmail.com</strong><br>
                                                                                    <small class="text-muted">10:00 am</small>
                                                                                </div>
                                                                            </div>
                                                                            <div class="d-flex justify-content-between" style="font-size: 14px;">
                                                                                <div class="me-4">to me</div>

                                                                                <div>
                                                                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-star" viewBox="0 0 16 16">
                                                                                        <path d="M2.866 14.85c-.078.444.36.791.746.593l4.39-2.256 4.389 2.256c.386.198.824-.149.746-.592l-.83-4.73 3.522-3.356c.33-.314.16-.888-.282-.95l-4.898-.696L8.465.792a.513.513 0 0 0-.927 0L5.354 5.12l-4.898.696c-.441.062-.612.636-.283.95l3.523 3.356-.83 4.73zm4.905-2.767-3.686 1.894.694-3.957a.56.56 0 0 0-.163-.505L1.71 6.745l4.052-.576a.53.53 0 0 0 .393-.288L8 2.223l1.847 3.658a.53.53 0 0 0 .393.288l4.052.575-2.906 2.77a.56.56 0 0 0-.163.506l.694 3.957-3.686-1.894a.5.5 0 0 0-.461 0z"/>
                                                                                    </svg>
                                                                                </div>

                                                                                <div class="mx-3">
                                                                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-arrow-90deg-left" viewBox="0 0 16 16">
                                                                                        <path fill-rule="evenodd" d="M1.146 4.854a.5.5 0 0 1 0-.708l4-4a.5.5 0 1 1 .708.708L2.707 4H12.5A2.5 2.5 0 0 1 15 6.5v8a.5.5 0 0 1-1 0v-8A1.5 1.5 0 0 0 12.5 5H2.707l3.147 3.146a.5.5 0 1 1-.708.708z"/>
                                                                                    </svg>
                                                                                </div>

                                                                                <div>
                                                                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-three-dots-vertical" viewBox="0 0 16 16">
                                                                                        <path d="M9.5 13a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0m0-5a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0m0-5a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0"/>
                                                                                    </svg>
                                                                                </div>

                                                                            </div>
                                                                        </div>
                                                                          
                                                                        
                                                                        <!-- Email Template Content -->
                                                                        <div *ngIf="selectedTemplate" class="d-flex flex-wrap justify-content-center gap-4">
                                                                            <div class="position-relative" style="width: 415px;">
                                                                              <div class="p-3 border rounded position-relative"
                                                                                   [ngStyle]="{
                                                                                     'background-color': selectedTemplate.backgroundColor || '#ffeb00',
                                                                                     'border-color': selectedTemplate.backgroundColor || '#ffeb00'
                                                                                   }">
                                                                          
                                                                                <!-- Logo Section -->
                                                                                <div class="d-flex justify-content-center mb-3">
                                                                                  <div style="width: 100px; height: 100px; background-color: white; border-radius: 5px;">
                                                                                    <img *ngIf="selectedTemplate.logo?.length" [src]="selectedTemplate.logo[0].url" alt="Logo" style="width: 100%; height: 100%; object-fit: cover; border: 1px solid white;" />
                                                                                  </div>
                                                                                </div>
                                                                          
                                                                                <!-- Alert Title -->
                                                                                <div class="bg-white text-center py-2 mb-2"
                                                                                     [ngStyle]="{
                                                                                       'color': selectedTemplate.titleFontColor,
                                                                                       'font-family': selectedTemplate.titleFontFamily,
                                                                                       'font-weight': selectedTemplate.titleisBold ? 'bold' : 'normal',
                                                                                       'font-style': selectedTemplate.titleisItalic ? 'italic' : 'normal',
                                                                                       'font-size.px': selectedTemplate.titleFontSize || 14
                                                                                     }">
                                                                                  {{ stripAndTruncateHtml(selectedTemplate.titleHtml) }}
                                                                                </div>
                                                                          
                                                                                <!-- Description -->
                                                                                <div class="bg-white p-3" style="min-height: 350px;"
                                                                                     [ngStyle]="{
                                                                                       'color': selectedTemplate.desFontColor,
                                                                                       'font-size.px': 14
                                                                                     }">
                                                                                  {{ stripAndTruncateHtml(selectedTemplate.descHtml) }}
                                                                                </div>
                                                                          
                                                                              </div>
                                                                            </div>
                                                                        </div>
                                                                        
                                                                        <!-- Reply and Forward Buttons -->
                                                                        <div class="d-flex justify-content-start gap-3 pt-3 ps-3 mb-3">
                                                                          <button class="btn btn-outline-secondary rounded-pill btn-sm px-4">↩️ Reply</button>
                                                                          <button class="btn btn-outline-secondary rounded-pill btn-sm px-4">➡️ Forward</button>
                                                                        </div>
                                                                      
                                                                    </div>
                                                                      
                                                                    
                                                            
                                                                    <!-- Monitor Stand Arm -->
                                                                    <div class="d-flex justify-content-center mt-3">
                                                                      <div style="width: 100px; height: 15px; background: #333; border-radius: 10px;"></div>
                                                                    </div>
                                                            
                                                                    <!-- Monitor Base (Half Circle) -->
                                                                    <div class="d-flex justify-content-center mt-1">
                                                                      <div style="width: 200px; height: 20px; background: #333; border-radius: 0 0 100px 100px;"></div>
                                                                    </div>
                                                            
                                                                  </div>
                                                                </div>
                                                            </c-modal-body>

                                                            <c-modal-footer>
                                                                <button (click)="toggleDesPreTempDemo()" cButton color="secondary">Close</button>
                                                            </c-modal-footer>
                                                        </c-modal>


                                                        <!-- Logo Section -->
                                                        <div class="d-flex justify-content-center">
                                                            <div style="width: 50px; height: 60px; background-color: white; border-radius: 5px;">
                                                                <img *ngIf="temp.logo && temp.logo.length" [src]="temp.logo[0].url" style="width: 100%; height: 100%; object-fit: cover; border: 1px solid white; " />
                                                            </div>
                                                        </div>


                                                        <!-- Title Section -->
                                                        <div class="bg-white text-center mt-3 p-2" [ngStyle]="{
                                                          'color': temp.titleFontColor,
                                                          'font-family': temp.titleFontFamily,
                                                          'font-weight': temp.titleisBold ? 'bold' : 'normal',
                                                          'font-style': temp.titleisItalic ? 'italic' : 'normal',
                                                          'font-size.px': 14,
                                                        }">
                                                            {{ stripAndTruncateHtml(temp.titleHtml) }}
                                                        </div>


                                                        <!-- Description Section -->
                                                        <div class="bg-white text-center mt-2 p-3" style="min-height: 80px;" [ngStyle]="{ 'color': temp.desFontColor, 'font-size.px': 14 }">{{ stripAndTruncateHtml(temp.descHtml) }}</div>

                                                    </div>

                                                </div>

                                                <!-- No Templates Message -->
                                                <div *ngIf="allTemplates?.length === 0" class="text-center my-2">
                                                    No Templates founds
                                                </div>

                                            </div>
                                        </c-card-body>

                                    </c-card>

                                    <!-- Second card -->
                                    <c-card class="my-3">
                                        <c-card-header class="fw-bold">Design Template</c-card-header>

                                        <c-card-body class="d-flex align-items-center justify-content-between flex-wrap">

                                            <!-- Logo -->
                                            <c-card class="w-100 mb-3">
                                                <c-card-body class="text-center">
                                                    <label for="file" class="form-label fw-semibold">Upload Logo</label>
                                                    <input type="file" id="file" class="form-control w-auto d-inline-block ms-2" (change)="onLogoSelected($event)" accept="image/*" />
                                                </c-card-body>
                                            </c-card>

                                            <!-- Color Button -->
                                            <div class="text-center mx-2">
                                                <button class="btn p-0 border rounded" [style.backgroundColor]="selectedFontColor" (click)="colorInput.click()" style="width: 40px; height: 40px;"></button>

                                                <input type="color" [(ngModel)]="selectedFontColor" #colorInput style="display: none;" />
                                                <small class="d-block mt-1">Color</small>

                                            </div>

                                            <!-- Font Button -->
                                            <div class="text-center mx-2">
                                                <select class="form-select" (change)="setFont($event)">
                                                    <option *ngFor="let font of googleFonts" [value]="font.css" [selected]="selectedFont === font.css">{{ font.name }}</option>
                                                </select>
                                                <small class="d-block mt-1">Font</small>
                                            </div>



                                            <!-- Bold Button -->
                                            <div class="text-center mx-2">
                                                <button class="btn p-0 border-0" (click)="toggleBold()">
                                                    <span class="fw-bold fs-5">AB</span>
                                                </button>
                                                <small class="d-block mt-1">Bold</small>
                                            </div>

                                            <!-- Italic Button -->
                                            <div class="text-center mx-2">
                                                <button class="btn p-0 border-0" (click)="toggleItalic()">
                                                    <span class="fst-italic fs-5">AB</span>
                                                </button>
                                                <small class="d-block mt-1">Italic</small>
                                            </div>

                                            <!-- Size Buttons -->
                                            <div class="text-center mx-2">
                                                <div class="d-flex flex-column align-items-center border rounded px-2 py-1">
                                                    <button class="btn btn-sm p-0" (click)="increaseFontSize()">
                                                        <span style="font-size: 16px;">▲</span>
                                                    </button>

                                                    <span style="line-height: 1;">{{ fontSize }}</span>

                                                    <button class="btn btn-sm p-0" (click)="decreaseFontSize()">
                                                        <span style="font-size: 16px;">▼</span>
                                                    </button>
                                                </div>
                                                <small class="d-block mt-1">Size</small>
                                            </div>

                                        </c-card-body>
                                    </c-card>

                                    <!-- Third card -->
                                    <div class="d-flex gap-3 flex-wrap">

                                        <!-- First Card -->
                                        <c-card class="p-3" style="flex: 1;">
                                            <c-card-body class="d-flex justify-content-start align-items-center gap-4">

                                                <!-- Text Field Label -->
                                                <div class="text-center">
                                                    <span>Text Field</span>
                                                </div>

                                                <!-- Text Color Picker (Live Preview) -->
                                                <div class="text-center">
                                                    <button class="btn p-0 border rounded" (click)="textColorInput.click()" [style.backgroundColor]="selectedTextColor" style="width: 40px; height: 40px;"></button>

                                                    <input type="color" #textColorInput [(ngModel)]="selectedTextColor" style="display: none;" />
                                                    <small class="d-block mt-1">Text Color</small>
                                                </div>

                                            </c-card-body>
                                        </c-card>

                                        <!-- Second Card -->
                                        <c-card class="p-3" style="flex: 1;">
                                            <c-card-body class="d-flex justify-content-start align-items-center gap-4">

                                                <!-- Background Label -->
                                                <div class="text-center">
                                                    <span>Background</span>
                                                </div>

                                                <!-- Color Picker Button -->
                                                <div class="text-center">
                                                    <button class="btn p-0 border rounded" (click)="bgColorInput.click()" [style.backgroundColor]="backgroundColor" style="width: 40px; height: 40px;"></button>

                                                    <input type="color" #bgColorInput [(ngModel)]="backgroundColor" style="display: none;" />
                                                    <small class="d-block mt-1">Background Color</small>
                                                </div>
                                            </c-card-body>
                                        </c-card>

                                    </div>

                                </c-card-body>
                            </c-card>
                        </div>

                        <!-- Second Section -->
                        <div class="col-md-5">

                            <!-- Main card -->
                            <c-card>
                                <c-card-header class="text-center">Current Template Preview</c-card-header>
                                <c-card-body class="bg-purple text-dark" [ngStyle]="{ 'background-color': backgroundColor }" style="min-height: 500px; padding: 1rem;">
                                    <div #previewContainer>

                                        <!-- Logo live Preview -->
                                        <div class="mx-auto mb-3 top-white-box" style="width: 150px; height: 180px; background-color: white;">
                                            <img *ngIf="logoDataUrl" [src]="logoDataUrl" alt="Logo" style="border: 1px solid white; width: 100%; height: 100%; object-fit: cover;" />
                                        </div>

                                        <!-- Title -->
                                        <div class="bg-white py-2 mb-2 text-center" contenteditable="true" #titleContent 
                                            [ngStyle]="{
                                                'color': selectedFontColor,
                                                'font-family': selectedFont,
                                                'font-weight': isBold ? 'bold' : 'normal',
                                                'font-style': isItalic ? 'italic' : 'normal',
                                                'font-size.px': fontSize
                                            }">
                                            {{ titleText }}
                                        </div>


                                        <!-- Description -->
                                        <div class="bg-white py-3 mb-3 ps-3 text-start" style="min-height: 345px;" contenteditable="true" #descContent [ngStyle]="{ 'color': selectedTextColor, }">
                                            {{ descText }}
                                        </div>

                                    </div>

                                </c-card-body>

                            </c-card>

                        </div>

                    </div>

                </c-modal-body>

                <c-modal-footer>
                    <button (click)="toggleAddTemplateDemo()" cButton color="secondary">Close</button>
                    <button (click)="saveTemplate()" cButton color="primary">Save</button>
                </c-modal-footer>
            </c-modal>

            <!-- Body section -->
            <c-card-body class="py-3 px-2">
                <div class="row">

                    <!-- Show categories Section -->
                    <div class="col-md-4">
                        <c-card>
                            <c-card-body class="text-center">
                                <h6>View Category</h6>
                                <c-row>
                                    <c-col [sm]="12">
                                        <c-card class="my-3">
                                            <c-card-body>
                                                <div
                                                    style="display: flex !important; justify-content: center; flex-direction: column;">

                                                    <!-- Dropdown for All Categories -->
                                                    <select aria-label="Default select example" cSelect class="form-select my-2 rounded-pill text-dark text-center" [(ngModel)]="selectedCategoryId">
                                                        <option value="" disabled selected>Select a category</option>
                                                        <option *ngFor="let category of allCategories" [value]="category._id">Customer 
                                                            <span>{{ category.categoryName.charAt(0).toUpperCase() + category.categoryName.slice(1) }}</span>
                                                        </option>
                                                    </select>
                                                </div>
                                            </c-card-body>
                                        </c-card>
                                    </c-col>

                                    <!-- Add Template Button -->
                                    <div>
                                        <button cButton (click)="toggleAddTemplateDemo()">Add New Template</button>
                                    </div>

                                </c-row>
                            </c-card-body>
                        </c-card>
                    </div>

                    <!-- Show Template Section -->
                    <div class="col-md-8">
                        <c-row>
                            <c-col [sm]="12">
                                <c-card>
                                    <c-card-body>

                                        <!-- Header Carousel -->
                                        <c-col [sm]="12" class="pb-4">
                                            <c-card>
                                                <c-card-body class="bg-secondary rounded">

                                                    <!-- Carousel Section -->
                                                    <c-carousel [animate]="false" transition="crossfade">

                                                        <!-- Carousel Pre Button -->
                                                        <c-carousel-control [routerLink] caption="Previous" direction="prev">
                                                            
                                                            <div class="d-flex ps-5">
                                                                <div class="text-nowrap me-1">
                                                                    Template Library
                                                                </div>
                                                                <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" fill="currentColor" class="bi bi-caret-left-fill" viewBox="0 0 16 16">
                                                                    <path d="m3.86 8.753 5.482 4.796c.646.566 1.658.106 1.658-.753V3.204a1 1 0 0 0-1.659-.753l-5.48 4.796a1 1 0 0 0 0 1.506z" />
                                                                </svg>
                                                            </div>

                                                        </c-carousel-control>

                                                        <!-- Carousel Body -->
                                                        <c-carousel-inner>
                                                            <c-carousel-item *ngFor="let slide of slides" class="text-center">
                                                                <!-- <img [src]="slide.src" alt="{{slide.title}}"
                                                                    class="d-block w-10" loading="lazy"> -->
                                                                <div>{{slide.title}}</div>
                                                            </c-carousel-item>
                                                        </c-carousel-inner>

                                                        <!-- Carousel Next Button -->
                                                        <c-carousel-control [routerLink] caption="Next" direction="next" class="color-black">
                                                            <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" fill="currentColor" class="bi bi-caret-right-fill" viewBox="0 0 16 16">
                                                                <path d="m12.14 8.753-5.482 4.796c-.646.566-1.658.106-1.658-.753V3.204a1 1 0 0 1 1.659-.753l5.48 4.796a1 1 0 0 1 0 1.506z" />
                                                            </svg>1/30
                                                        </c-carousel-control>

                                                    </c-carousel>
                                                </c-card-body>
                                            </c-card>
                                        </c-col>

                                        <!-- Template Section -->
                                        <c-col [sm]="12">
                                            <c-card>
                                              <c-card-body>
                                          
                                                <!-- Loader while fetching -->
                                                <ng-container *ngIf="!isTemplatesLoaded">
                                                    <div class="text-center my-5">
                                                      <div class="spinner-border text-primary" role="status">
                                                        <span class="visually-hidden">Loading...</span>
                                                      </div>
                                                      <div>Loading Templates...</div>
                                                    </div>
                                                </ng-container>
                                          
                                                <!-- Carousel Section after templates are loaded -->
                                                <ng-container *ngIf="isTemplatesLoaded">
                                                  <ng-container *ngIf="allTemplates.length > 0; else noTemplates">
                                          
                                                    <!-- Actual Carousel -->
                                                    <ng-container *ngIf="carouselVisible">
                                                        <c-carousel [interval]="0" [animate]="true" transition="crossfade">
                                                            
                                                            <!-- Template Body -->
                                                            <c-carousel-inner>
                                                
                                                                <!-- Each Template will be a Slide -->
                                                                <c-carousel-item *ngFor="let temp of allTemplates; let i = index" [ngClass]="{'active': i === 0}">
                                                                    <c-row>

                                                                        <!-- Pre Button Section -->
                                                                        <c-col [sm]="3"></c-col>

                                                                        <!-- Template Section -->
                                                                        <c-col [sm]="6" class="mx-auto">                                            
                                                                            <c-card>
                                                                                <c-card-body style="border: 1px solid rgb(159, 159, 159);">
                                                                                    <div class="d-flex flex-wrap justify-content-center gap-4">
                                                            
                                                                                        <!-- Template Card -->
                                                                                        <div class="position-relative" style="width: 300px;">
                                                                                            <div class="p-3 border rounded position-relative" (mouseenter)="hoveredTemplateId = temp._id" (mouseleave)="hoveredTemplateId = null" [ngStyle]="{'background-color': temp.backgroundColor || '#8000b0', 'border-color': temp.backgroundColor || '#8000b0'}">
                                                                
                                                                                                <!-- Logo Section -->
                                                                                                <div class="d-flex justify-content-center">
                                                                                                    <div style="width: 100px; height: 110px; background-color: white; border-radius: 5px;">
                                                                                                        <img *ngIf="temp.logo && temp.logo.length" alt="logo" [src]="temp.logo[0].url" style="width: 100%; height: 100%; object-fit: cover; border: 1px solid white;" />
                                                                                                    </div>
                                                                                                </div>
                                                                
                                                                                                <!-- Title Section -->
                                                                                                <div class="bg-white text-center mt-3 p-2" [ngStyle]="{
                                                                                                'color': temp.titleFontColor,
                                                                                                'font-family': temp.titleFontFamily,
                                                                                                'font-weight': temp.titleisBold ? 'bold' : 'normal',
                                                                                                'font-style': temp.titleisItalic ? 'italic' : 'normal',
                                                                                                'font-size.px': 14
                                                                                                }">
                                                                                                {{ stripAndTruncateHtml(temp.titleHtml) }}
                                                                                                </div>
                                                                
                                                                                                <!-- Description Section -->
                                                                                                <div class="bg-white text-center mt-2 p-3" style="min-height: 180px;" [ngStyle]="{'color': temp.desFontColor, 'font-size.px': 14}">
                                                                                                    {{ stripAndTruncateHtml2(temp.descHtml) }}
                                                                                                </div>
                                                                                            </div>
                                                                                        </div>
                                                            
                                                                                    </div>
                                                                                </c-card-body>
                                                                            </c-card>                                            
                                                                        </c-col>

                                                                        <!-- Next Button Section -->
                                                                        <c-col [sm]="3"></c-col>
                                                                    </c-row>
                                                                </c-carousel-item>
                                                
                                                            </c-carousel-inner>
                                            
                                                            <!-- Prev Buttons -->
                                                            <c-carousel-control caption="Previous" direction="prev">
                                                                <div class="d-flex justify-content-center align-items-center h-100">
                                                                <svg xmlns="http://www.w3.org/2000/svg" width="60" height="60" fill="black" class="bi bi-caret-left-fill" viewBox="0 0 16 16" style="cursor: pointer;">
                                                                    <path d="m3.86 8.753 5.482 4.796c.646.566 1.658.106 1.658-.753V3.204a1 1 0 0 0-1.659-.753l-5.48 4.796a1 1 0 0 0 0 1.506z" />
                                                                </svg>
                                                                </div>
                                                            </c-carousel-control>
                                                            
                                                            <!-- Next Buttons -->
                                                            <c-carousel-control caption="Next" direction="next">
                                                                <svg style="cursor: pointer;" xmlns="http://www.w3.org/2000/svg" width="60" height="60" fill="black" class="bi bi-caret-right-fill" viewBox="0 0 16 16">
                                                                <path d="m12.14 8.753-5.482 4.796c-.646.566-1.658.106-1.658-.753V3.204a1 1 0 0 1 1.659-.753l5.48 4.796a1 1 0 0 1 0 1.506z" />
                                                                </svg>
                                                            </c-carousel-control>
                                            
                                                        </c-carousel>
                                                    </ng-container>
                                          
                                                    <!-- Save/Update Buttons -->
                                                    <div class="mt-3 d-flex justify-content-center">
                                                      <!-- <button cButton class="me-3">Save</button> -->
                                                      <!-- <button cButton color="secondary">Update</button> -->
                                                    </div>
                                          
                                                  </ng-container>
                                          
                                                  <!-- No Templates Case -->
                                                  <ng-template #noTemplates>
                                                    <div class="text-center text-danger my-5">No Templates Added</div>
                                                  </ng-template>
                                          
                                                </ng-container>
                                          
                                              </c-card-body>
                                            </c-card>
                                        </c-col>
                                          

                                    </c-card-body>
                                </c-card>
                            </c-col>
                        </c-row>
                    </div>

                </div>
            </c-card-body>

        </c-card>
    </c-col>
</c-row>